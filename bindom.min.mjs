/* eslint-disable */
const registry=new Map,wait=new Map;function hasClass(e){return registry.has(e)}function getClass(e,t=3e3){return registry.has(e)?Promise.resolve(registry.get(e)):(wait.has(e)||wait.set(e,[]),new Promise((n,o)=>wait.get(e).push({resolve:n,timeoutId:iniTimeout(e,t,o)})))}function iniTimeout(e,t,n){return setTimeout(()=>n(new Error(`Failed to register required class "${e}" after ${t}ms`)),t)}function addClass(e,t={}){checkNew(e);const n={Class:e,...t};registry.set(e.name,n),resolveWait(e,n)}function checkNew({name:e}){if(registry.has(e))throw new Error(`Cannot register class "${e}", because it already exists`)}function resolveWait({name:e},t){if(wait.has(e)){for(const{resolve:n,timeoutId:o}of wait.get(e))clearTimeout(o),n(t);wait.delete(e)}}const aExp=/^(attr:)|@/,pExp=/^(prop:)|\./,tExp=/^((text:)|§)$/;class Quary extends Array{constructor(e,t){if(0===e)return super(0);let n;n=Array.isArray(e)?e:"string"==typeof e?[quary.template(e)]:e instanceof Quary?e:e instanceof NodeList||e instanceof HTMLCollection?Array.from(e):[e.shadowRoot||e],t&&(n=find(n,t)),super(...n)}access(e,t){const[,n,o]=e.match(/^(.)(.*)$/),r=arguments.length>1;switch(n){case"@":return r?this.attr(o,t):this.map(e=>e.getAttribute(o));case".":return r?this.prop(o,t):this.map(e=>e[o]);case"§":return r?this.text(t):this.map(e=>e.nodeType===Node.TEXT_NODE&&e.nodeValue||textNode(e)&&textNode(e).nodeValue);default:throw new Error('Key in calls to "access" must start with "@", ".", or "§"')}}addClass(e){for(const t of this)t.classList&&t.classList.add(e);return this}after(e){for(const t of this){const n=t.parentNode;t===n.lastChild?toNodes(n,e,e=>n.appendChild(e)):toNodes(n,e,e=>n.insertBefore(e,t.nextSibling))}return this}append(e){for(const t of this)toNodes(t,e,e=>t.appendChild(e));return this}attr(e,t){if(1===arguments.length)return this[0]&&this[0].getAttribute&&this[0].getAttribute(e);if(void 0===t||!1===t||null===t)for(const t of this)t.removeAttribute&&t.removeAttribute(e);else{"string"!=typeof t&&(t=JSON.stringify(t));for(const n of this)n.setAttribute&&n.setAttribute(e,t)}return this}before(e){for(const t of this)toNodes(t.parentNode,e,e=>t.parentNode.insertBefore(e,t));return this}call(e,...t){return this.map(n=>n[e]&&n[e](...t))}ccall(e,...t){for(const n of this)n[e]&&n[e](...t);return this}emit(e,t){if(e instanceof Event&&t)throw new Error("EITHER pass an Event instance OR optionally pass customEventInit");"string"==typeof e&&(e=new CustomEvent(e,t||{}));for(const t of this)t.dispatchEvent&&t.dispatchEvent(e);return this}hasClass(e){for(const t of this)if(t.classList&&t.classList.contains(e))return!0;return!1}off(e,t){for(const n of this)if(aExp.test(e))try{n[obsKey(attrFilter(e))][t].disconnect()}catch(e){}else if(pExp.test(e))offProp(n,e,t);else if(tExp.test(e))try{n[obsKey(textFilter())][t].disconnect()}catch(e){}else n.removeEventListener&&n.removeEventListener(e,t._quaryNoSelf||t);return this}on(e,t,n){const o=3===arguments.length&&"noSelf"===t;2===arguments.length&&(n=t);for(const t of this)tExp.test(e)?observer(t,o,n,textFilter()):aExp.test(e)?observer(t,o,n,attrFilter(e)):pExp.test(e)?onProp(t,e,o,n):t.addEventListener&&t.addEventListener(e,o?noSelf(n):n);return this}once(e,t){for(const n of this)tExp.test(e)?onceObserver(n,t,textFilter()):aExp.test(e)?onceObserver(n,t,attrFilter(e)):pExp.test(e)?onceProp(n,e,t):n.addEventListener&&n.addEventListener(e,t,{once:!0});return this}prepend(e){for(const t of this)t.firstChild?toNodes(t,e,e=>t.insertBefore(e,t.firstChild)):toNodes(t,e,e=>t.appendChild(e));return this}prop(e,t){if(1===arguments.length)return this[0]&&this[0][e];for(const n of this)n[e]=t;return this}query(e){return new Quary(find(this,e))}removeClass(e){for(const t of this)t.classList&&t.classList.remove(e);return this}shadow(e,t={mode:"open"}){for(const n of this){if(!n.attachShadow)continue;const o=n.attachShadow(t);e&&o.appendChild($.template(e))}return this}text(e){if(!arguments.length)return this[0]&&this[0].firstChild&&(this[0].firstChild.nodeType===Node.TEXT_NODE&&this[0].firstChild.nodeValue||textNode(this[0])&&textNode(this[0]).nodeValue);for(const t of this)t.firstChild&&t.firstChild.nodeType===Node.TEXT_NODE?t.firstChild.nodeValue=e:textNode(t,!0).nodeValue=e;return this}toggleClass(e,t){if(1===arguments.length)for(const t of this)t.classList&&t.classList.toggle(e);else{t=!!t;for(const n of this)n.classList&&n.classList.toggle(e,t)}return this}when(e){return new Promise(t=>this.once(e,t))}}function quary(e,t){return new Quary(e,t)}const $=quary;function toNodes(e,t,n){if(t instanceof HTMLTemplateElement)return n(t.content.cloneNode(!0));if(t instanceof Node)return n(t);if(t.constructor===Object&&(t=quary.template(t)),"function"==typeof t)return isProcessDynNodes(t)?t(e,n):n(t());t instanceof Array||(t=new Quary(t));for(const e of t)n(e)}function find(e,t){const n=[];for(let o=0;o<e.length;o++)if(/:host/.test(t))for(let r of t.split(","))if(/^\s*:host\s*/.test(r)){r=r.replace(/^\s*:host\s*/,"");let t=e[o].host||e[o];"string"==typeof t&&(t=e[o]),/[^\s]/.test(r)?n.push(...t.querySelectorAll(r)):n.push(t)}else n.push(...e[o].querySelectorAll(r));else e[o].querySelectorAll&&n.push(...e[o].querySelectorAll(t));return n}function textNode(e,t){for(let t=0;t<e.childNodes.length;t++)if(e.childNodes[t].nodeType===Node.TEXT_NODE)return e.childNodes[t];if(t)return console.warn&&console.warn('Quary is creating a text node. For performance reason you should put the text node into your DOM from the start (e.g. as an empty space or zero width space "&#8203;")'),e.appendChild(document.createTextNode("")),e.lastChild}function attrFilter(e){return{attributes:!0,attributeFilter:[e.replace(aExp,"")]}}function textFilter(){return{characterData:!0,subtree:!0}}function onceObserver(e,t,n){const o=observer(e,!1,function(...e){o.disconnect(),t(...e)},n,t)}function observer(e,t,n,o,r=n){const s=new MutationObserver(t?noSelf(n,!0):n);return s.observe(e,o),e[obsKey(o)]?e[obsKey(o)][r]=s:e[obsKey(o)]={[r]:s},s}function obsKey(e){return`_quaryObserver${JSON.stringify(e)}`}function offProp(e,t,n){const o=t.replace(pExp,""),r=propKey(o);if(!e[r])return;const s=e[r].listener,i=s.indexOf(n._quaryNoSelf||n);if(-1!==i&&s.splice(i,1),s.length)return;const a=e[r].value;delete e[r],delete e[o],e[o]=a}function onceProp(e,t,n){onProp(e,t,!1,function _onceListener(...o){offProp(e,t,_onceListener);n(...o)})}function onProp(e,t,n,o){const r=t.replace(pExp,""),s=propKey(r);let i;e[s]?i=!0:e[s]={listener:[]},e[s].listener.push(n?noSelf(o):o),i||(e instanceof HTMLInputElement&&("value"===r||"checked"===r)?onInputValueChange(e,r,s,t):e instanceof HTMLSelectElement&&"value"===r&&onInputValueChange(e,r,s,t),onPropertyChange(e,r,s))}function onInputValueChange(e,t,n,o){const r=`${n}-Listener`;if(!e[r])switch(t){case"value":e[r]=!0,e.addEventListener("change",()=>{e[n].value=e.value,tell(e,e[n],o)});break;case"checked":e[r]=!0,e.addEventListener("change",()=>{e[n].checked=e.checked,tell(e,e[n],o)})}}function onPropertyChange(e,t,n,o){(Object.prototype.hasOwnProperty.call(e,t)||void 0!==e[t])&&(e[n].value=e[t],delete e[t]);const r=htmlElementProperty(e,t);Object.defineProperty(e,t,{get:function(){return r?r.get.call(this):e[n].value},set:function(t){return r?(r.set.call(this,t),e[n].value=r.get.call(this)):e[n].value=t,tell(e,e[n],o),t},enumerable:!0,configurable:!0})}function htmlElementProperty(e,t){try{for(;e;){e=Object.getPrototypeOf(e);const n=Object.getOwnPropertyDescriptor(e,t);if(n)return n}}catch(e){return}}function propKey(e){return`_quaryProp${e}`}function tell(e,t,n){for(const o of t.listener)o(t.value,e,n)}function noSelf(e,t){let n;return e._quaryNoSelf=function(){n||(n=!0,e(),t?setTimeout(function(){n=!1}):n=!1)}}const templates$1={};let processDynNodesRef;function dynTemplate(e){const{array:t=[void 0],chunks:n,id:o="default",update:r}=e,s=e.template,i=`_quaryChildArrayDynNode${o}`,a=`_quaryChildArrayTimeout${o}`;function processDynNodes(o,c){o[a]&&(clearTimeout(o[a]),delete o[a]),o[i]||(o[i]=[]);const d=o[i];if(Object.prototype.hasOwnProperty.call(e,"condition")&&!e.condition)return removeNodes(0);function removeNodes(e){for(let t=e;t<d.length;t++)for(let e=0;e<d[t].length;e++)o.removeChild(d[t][e]);d.splice(e)}function iterDynNodeChunk(r){r>=t.length?e.done&&e.done():!n||r%n?iterNodeArray(r):o[a]=setTimeout(()=>iterNodeArray(r))}function iterNodeArray(e){let n=o[i][e];if(!n){const e=$.template(s);n=$(e.childNodes),c(e),o[i].push(n)}r&&r($(n),t[e],e),delete o[a],iterDynNodeChunk(++e)}d.length>t.length&&removeNodes(t.length),iterDynNodeChunk(0)}return processDynNodesRef=processDynNodes.prototype.constructor,processDynNodes}function isProcessDynNodes(e){return processDynNodesRef&&e&&e.prototype&&e.prototype.constructor===processDynNodesRef}function parse(e,t,n){return assemble(n,t.map(parseBoundNode(e)).flat())}function parseBoundNode(e){return function(t){return t.dataset.bind.replace(/\s+/g,";").replace(/(?:^;)|(?:;$)/g,"").split(";").filter(e=>e).map(n=>parseSingleBinding(e.includes(t),sq(t),n)).filter(e=>e)}}function sq(e){return e.shadowRoot?quary(e,":host"):quary(e)}function parseSingleBinding(e,t,n){const o=/÷/.test(n)?"÷":":",r=n.split(o);validateSingleBinding(r);const s=parseKey(e,t,r[0]);if(s)return{node:t,key:s,to:parseDomExp(r[1])}}function validateSingleBinding(e){if(2!==e.length)throw new Error(`Invalid binding "${e.join(":")}"; expecting "key:domBindExpression" or "key÷domBindExpression"`)}function parseKey(e,[t],n){return e?!/^\^/.test(n)&&n.split("."):t.hasAttribute("data-class")?!!/^\^/.test(n)&&n.replace(/^\^/,"").split("."):n.split(".")}function parseDomExp(e){const t=e.replace(/(?:^[.!@§])|(?:\(\)$)/,"");return/^\./.test(e)?{type:"prop",on:e,key:t}:/^!/.test(e)?{type:"event",on:e,key:t}:/^@/.test(e)?{type:"attr",on:e,key:t}:/^§/.test(e)?{type:"text",on:e,key:t}:/^\*$/.test(e)?{type:"node"}:/\(\)$/.test(e)?{type:"func",key:t}:void bindExpErr(e)}function bindExpErr(e){throw new Error(`Invalid DOM-bind-expression "${e}"; expecting ".property" or "!event" or "@attribute" or "§" (for text)`)}function assemble(e,t){const n={};let o;const r=e=>o=t.filter(({key:t})=>t.length>e);for(let e=0;r(e).length;e++)for(const t of o)setMap(n,e,t);return n}function setMap(e,t,n){let o=e;for(let e=0;e<t;e++)o=o[n.key[e]].def;const r=n.key[t];n.key.length===t+1?setMapLeaf(o,r,n):o[r]&&Array.isArray(o[r].def)?inconsistentBindings(n):o[r]||(o[r]={def:{}})}function setMapLeaf(e,t,n){e[t]?Array.isArray(e[t].def)||inconsistentBindings(n):e[t]={def:[]},e[t].def.push(n)}function inconsistentBindings({key:e}){throw new Error(`Inconsistent binding for ${e.join(".")}; EITHER nested object OR binding`)}function boundObject(e,t){return bindObject(e,t)}function bindObject(e,t,n=[]){for(const[o,r]of Object.entries(t)){const{get:t,set:s}=accessor(e,r.def,n.concat([o]));Object.defineProperty(e,o,{get:t,set:s,configurable:!0})}return e}function addProperty(e,t,n,o){for(const{obj:r,prop:s}of path(e,n)){t[s]=o;const{get:e,set:i}=accessor(r,o.def,n);Object.defineProperty(r,s,{get:e,set:i,configurable:!0})}}function updateProperty(e,t,n){for(const{obj:o,prop:r}of path(e,n)){const{def:e}=t[r];if(delete o[r],e.revertProp&&o.defineProperty(r,e.revertProp),!e.length)return delete t[r];const{get:s,set:i}=accessor(o,e,n);Object.defineProperty(o,r,{get:s,set:i,configurable:!0})}}function accessor(e,t,n){return Array.isArray(t)?1===t.length?simpleAccessor(e,t[0]):arrayAccessor(e,t):objectAccessor(e,t,n)}function simpleAccessor(e,t){switch(t.to.type){case"event":return eventAccessor(e,t);case"func":return funcAccessor(t);case"node":return nodeAccessor(t);case"text":return textAccessor(e,t);default:return defaultAccessor(e,t)}}function eventAccessor(e,t){return registerListener(e,t,t.to.key,e=>e),{get(){throw new Error(`Cannot get event "${t.to.key}" with key "${t.key}"`)},set:e=>t.node.emit(t.to.key,e)}}function registerListener(e,t,n,o){const r=getSetter(e,t.key.at(-1),t);if(!r)return;const s=propagateToBound(e,t.key,r,o);t.eventListener={evt:n,handler:s},t.node.on(n,s)}function getSetter(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t)){const o=Object.getOwnPropertyDescriptor(e,t);return n&&(n.revertProp=o),o.set}const o=Object.getPrototypeOf(e);if(o)return getSetter(o,t)}function propagateToBound(e,t,n,o){return function(r){for(const{obj:s,prop:i}of path(e,t))s===e&&i===t[0]?n.call(e,o(r)):s[i]=o(r)}}function funcAccessor({node:e,to:t,key:n}){return{get:()=>(...n)=>e.call(t.key,...n),set(){throw new Error(`Cannot assign to bound function "${t.key}" with key "${n}"`)}}}function nodeAccessor({node:e,key:t}){return{get:()=>()=>e,set(){throw new Error(`Cannot assign to bound node with key "${t}"`)}}}function defaultAccessor(e,t){const n={get:()=>t.node[t.to.type](t.to.key),set:e=>t.node[t.to.type](t.to.key,e)};return registerListener(e,t,t.to.on,()=>n.get()),propagateToDom(e,t,n),n}function textAccessor(e,t){registerListener(e,t,"§",()=>t.node.text());const n={get:()=>t.node.text(),set:e=>t.node.text(e)};return propagateToDom(e,t,n),n}function*path(e,t){for(const n of t.slice(0,-1))if(!(e=e[n]))return;yield{obj:e,prop:t.at(-1)}}function propagateToDom(e,t,n){const o=t.key.at(-1);Object.prototype.hasOwnProperty.call(e,o)&&n.set(e[o])}function arrayAccessor(e,t){return t=t.map(t=>simpleAccessor(e,t)),{get:()=>t.map(({get:e})=>e()),set:e=>t.map(({set:t})=>t(e))}}function objectAccessor(e,t,n){const o=e[n.at(-1)]||{};return bindObject(o,t,n),{get:()=>o,set:e=>(Object.entries(e).forEach(([e,t])=>o[e]=t),o)}}function selectBound(e){const t=e.query("[data-class]");return e.query("[data-bind]").filter(e=>{for(const n of t){if(parentBinding(n,e))return!0;if(n.contains(e))return!1}return!0}).concat(e.filter(e=>e.matches&&e.matches("[data-bind]")))}function parentBinding(e,t){return e===t&&/\^[^:]+:/.test(e.getAttribute("data-bind"))}function isLeaf(e,t){const n=Array.isArray(e.def);if(n!==Array.isArray(t.def))throw new Error(`Cannot add/remove ${t.def} to/from ${e.def}`);return n}function scopeIds(e,t){const n=`${t}Id`;return e.dataset&&e.dataset[n]?e.dataset[n].split(",").map(e=>parseInt(e,10)):[]}function moveId(e,t,n,o){e.dataset&&scopeIds(e,n).includes(t)&&(removeId(e,t,n),addId(e,t,o))}function addId(e,t,n){e.dataset[`${n}Id`]=[...scopeIds(e,n),t].join(",")}function removeId(e,t,n){if(!e.dataset)return;const o=scopeIds(e,n).filter(e=>e!==t);o.length?e.dataset[`${n}Id`]=o.join(","):delete e.dataset[`${n}Id`]}function addNodes({scopeId:e,object:t,rootNodes:n,map:o,mutated:r}){findEntryPoints(t,o,parse(n,selectBound(r),t)),r.forEach(t=>moveId(t,e,"bind","bound")),n.emit("addedBound",{bubbles:!0})}function findEntryPoints(e,t,n,o=[]){for(const[r,s]of Object.entries(n)){const n=o.concat(r);t[r]?isLeaf(t[r],s)?mergeEntry(e,t,r,n,s.def):findEntryPoints(e,t[r].def,s.def,n):addProperty(e,t,n,s)}}function mergeEntry(e,t,n,o,r){t[n].def.push(...r),updateProperty(e,t,o)}function removeNodes({forgetScope:e,scopeId:t,object:n,rootNodes:o,map:r,mutated:s}){const i=selectBound(s);findRmPoints(n,r,parse(o,i,{})),e?i.forEach(e=>removeId(e,t,"bound")):i.forEach(e=>moveId(e,t,"bound","bind")),o.emit("removedBound",{bubbles:!0})}function findRmPoints(e,t,n,o=[]){for(const[r,s]of Object.entries(n))if(t[r])if(isLeaf(t[r],s)){const n=o.concat(r);rmEntry(e,t,r,s.def,n)}else removeNestedEntries(e,t,r,s,o)}function removeNestedEntries(e,t,n,o,r){findRmPoints(e,t[n].def,o.def,r),Object.keys(t[n].def).length||(delete t[n],delete e[n])}function rmEntry(e,t,n,o,r){const{def:s}=t[n];for(const e of o)s.splice(s.indexOf(s.find(({node:t})=>t===e.node)),1).forEach(removeEventListener);1!==s.length&&s.length||updateProperty(e,t,r)}function removeEventListener({addEventListener:e,node:t,eventListener:{evt:n,handler:o}={}}){e&&o&&t.off(n,o)}quary.template=function(e){if("string"==typeof e){if(templates$1[e])return templates$1[e].content.cloneNode(!0);const t=document.createElement("template");return t.innerHTML=e,templates$1[e]=t,t.content.cloneNode(!0)}return e instanceof HTMLTemplateElement?e.content.cloneNode(!0):dynTemplate(e)};const observed=new Map;class MutationEvaluator{constructor(e,t,n){this.mutationProp=e,this.handle=t,this.biound=n}process(e){const t=e.map(e=>Array.from(e[this.mutationProp])).flat();t.length&&(this.timeout?this.nodes.push(...t):(this.timeout=setTimeout(this.flush.bind(this)),this.nodes=t))}flush(){delete this.timeout,removeMoved(),evaluateMutation(this.nodes,this.handle,this.biound)}}const addition=new MutationEvaluator("addedNodes",addNodes,"bind"),removal=new MutationEvaluator("removedNodes",removeNodes,"bound");function observe(e){addition.process(e),removal.process(e)}function removeMoved(){const e=addition.nodes,t=removal.nodes;if(!e||!t)return;const n=e.filter(e=>t.includes(e));n.length&&(addition.nodes=e.filter(e=>!n.includes(e)),removal.nodes=t.filter(e=>!n.includes(e)))}function evaluateMutation(e,t,n){if(!e.length)return;const o=selectBound(quary(e));o.length&&boundScopes(o,n).forEach(t)}function boundScopes(e,t){const n={};for(const o of e)addToScope(n,o,t);return Object.values(n)}function addToScope(e,t,n){for(const o of scopeIds(t,n))e[o]?e[o].mutated.push(t):e[o]={...observed.get(o),mutated:quary(t),scopeId:o}}let currentId=0;function monitor(e,t,n,o){const r=currentId++;observed.set(r,{object:e,map:t,rootNodes:o}),addIdToDom(r,n,o),iniObserver()}function addIdToDom(e,t,n){t.forEach(({dataset:t})=>t.boundId=t.boundId?`${t.boundId},${e}`:e),addIdToTemplates(n,e)}function addIdToTemplates(e,t){filterBranch(e,"template:not([data-class])").forEach(({content:e})=>{const n=quary(e.children);selectBound(n).attr("data-bind-id",t),addIdToTemplates(n,t)})}function filterBranch(e,t){return e.query(t).concat(e.filter(e=>e.matches&&e.matches(t)))}function iniObserver(){if(currentId>1)return;new MutationObserver(observe).observe(document,{childList:!0,subtree:!0})}function unbind(e,t){if(!e.filter(e=>e.dataset&&e.dataset.boundId).length)return;const n=boundScopes(e,"bound");t?n.filter(filter(t)).forEach(rmNodes):n.forEach(rmNodes)}function rmNodes(e){removeNodes(Object.assign({forgetScope:!0},e))}function filter(e){if("object"==typeof e)return({object:t})=>e===t;if("number"==typeof e)return({scopeId:t})=>e===t;if("string"==typeof e){const t=parseInt(e,10);return({scopeId:e})=>t===e}}function bind$1(e,t){const n=selectBound(t),o=parse(t,n,e);return monitor(e,o,n,t),boundObject(e,o)}Quary.prototype.bind=function(e={}){return bind$1(e,this)},Quary.prototype.unbind=function(e){return unbind(this,e)};const styles=new Map;function addStyle(e){return styles.has(e)?styles.get(e):(quary(document.head).append(`<style>${e}</style>`),styles.set(e,document.head.lastChild),styles.get(e))}let id=0;const templates=new WeakMap,previousClass=new WeakMap,previousElement=new WeakMap;function insertAndBindTemplate(e,t={}){return withOutBinding(!0,e,t)}function insertTemplate(e,t={}){return withOutBinding(!1,e,t)}async function withOutBinding(e,t,n){const o=determineParent(t);if(!o)return;const r=determineInsertMethod(t),s=await getInsertOptions(e,t,n,e=>o[r]({id:e,template:t,array:[]}));return o[r](s)}function determineParent(e){return e.dataset.parent?findParent(e):e.dataset.insert?quary(e.parentElement):quary(e,":host")}function findParent(e){let t=e.parentElement;const n=e.dataset.parent;for(;t;){const e=t.querySelector(n);if(e)return quary(e);t=t.parentElement}}function determineInsertMethod(e){return e.dataset.insert?e.dataset.insert:e.dataset.parent?"append":"before"}async function getInsertOptions(e,t,n,o){const{id:r,Class:s}=await getTemplate(e,t,o),i={id:r,template:t,...n,done:done(t,n)};return e&&(i.update=bind(Object.assign(n,{Class:s}))),e&&!n.array&&(i.array=[new s]),i}async function getTemplate(e,t,n){if(!templates.has(t))return await iniTemplate(e,t);if(!e)return templates.get(t);const o=templates.get(t);return o.Class.name===t.dataset.class?o:(n(o.id),await updateTemplate(t,o,!0))}async function iniTemplate(e,t){if(!e)return templates.set(t,{id:`sq-instantiate-template-${id++}`}),templates.get(t);const n={id:`sq-instantiate-template-${id++}`};return templates.set(t,n),await updateTemplate(t,n)}async function updateTemplate(e,t,n){const{Class:o,style:r,template:s}=await getClass(e.dataset.class);r&&addStyle(r);const i=quary(e.content);return n&&i.append({array:[],id:t.id}),s&&i.append({template:s,id:t.id}),t.Class=o,t}function bind({Class:e,update:t,updateStrategy:n}){return function(o,r,s){if(doReOrNewBind(n,o,e))reOrNewBind(e,t,o,r,s);else{updateDom(o,r,s,t,"always"===n)}}}function doReOrNewBind(e,[t],n){return!e||"rebind"===e||previousClass.get(t)!==n&&(previousClass.set(t,n),!0)}function reOrNewBind(e,t,n,o,r){const s=o.constructor.name===e.name,i=s?o:new e;n.unbind(),i.proxy=quary(n).bind(i),n.forEach(e=>iniProxy$1(e,i.proxy)),s||n.forEach(e=>e.proxy=o),n.addClass(e.name),t&&t(n,o,r),n.emit("bound",{detail:o})}function iniProxy$1(e,t){Object.defineProperty(e,"proxy",{get:()=>t,set(e){Object.assign(t,e)},configurable:!0})}function updateDom(e,t,n,o,r){!r&&isIdentical(e,t)||(e.forEach(e=>e.proxy=t),o&&o(e,t,n),e.emit("updated",{detail:t}))}function isIdentical([e],t){if(previousElement.get(e)===t)return!0;previousElement.set(e,t)}function done(e,{done:t}){return function(){quary(e).emit("inserted"),t&&t()}}const map$1=new WeakMap;customElements.define("if-dom",class extends HTMLTemplateElement{get if(){return map$1.get(this)}set if(e){map$1.set(this,e),(this.hasAttribute("data-class")?insertAndBindTemplate:insertTemplate)(this,{condition:e})}},{extends:"template"});const map=new WeakMap;function defaultLoopClass(e){e.hasAttribute("data-class")||(hasClass("Object")||addClass(Object),e.setAttribute("data-class","Object"))}function handleUpdateStrategy(e,t){const[n,o]=e.dataset.update&&e.dataset.update.split(",")||[];if(n)return"unidentical"===n&&t===map.get(e)?"skip":o||n}function options(e,t,n){const o={array:t.map(e=>"object"==typeof e?e:{item:e})};return n&&(o.updateStrategy=n),e.hasAttribute("data-chunks")&&(o.chunks=parseInt(e.getAttribute("data-chunks"),10)),o}async function dataClassAttributeChangedCallback(e,t,n){if("data-class"!==e||!n)return;const o=await getClass(n),r=quary(this);iniDom(r,t,n,o),ini(r,o)}function iniDom(e,t,n,{bindHost:o,style:r,template:s}){if(r&&addStyle(r),t?e.removeClass(t):markPersistentChildren(e),e.addClass(n),s&&append(e,s),!o)return;const i=e.attr("data-bind");e.attr("data-bind",i?`${i};${o}`:o)}function markPersistentChildren(e){e.forEach(({childNodes:e})=>quary(e).forEach(e=>e._sqBindPersistent=!0))}function append(e,t){e.append({condition:!1,id:"dom-bind",template:t}),e.forEach(({childNodes:e})=>quary(e).filter(e=>!e._sqBindPersistent).call("remove")),e.append({condition:!0,id:"dom-bind",template:t})}function ini(e,{Class:t}){const n=new t,o=e.prop("proxy");o&&e.unbind(o),iniProxy(e[0],e.bind(n)),e.emit("bound",{detail:n})}function iniProxy(e,t){Object.defineProperty(e,"proxy",{get:()=>t,set(e){Object.assign(t,e)},configurable:!0})}customElements.define("loop-dom",class extends HTMLTemplateElement{constructor(...e){const t=super(...e);return defaultLoopClass(t),t}get array(){return map.get(this)}set array(e){const t=handleUpdateStrategy(this,e);"skip"!==t&&(map.set(this,e),defaultLoopClass(this),insertAndBindTemplate(this,options(this,e,t)))}},{extends:"template"}),customElements.define("bind-dom",class SqBind extends HTMLElement{static get observedAttributes(){return["data-class"]}async attributeChangedCallback(...e){dataClassAttributeChangedCallback.call(this,...e)}});export{addClass,addStyle,dataClassAttributeChangedCallback,quary as default,insertAndBindTemplate,insertTemplate};
